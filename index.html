<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>root@taha:~/ (TahaOS v1.0)</title>
    <style>
        /* --- CORE SYSTEM STYLES --- */
        :root {
            --bg-color: #0d1117;
            --term-bg: rgba(13, 17, 23, 0.95);
            --term-header: #161b22;
            --text-main: #c9d1d9;
            --text-muted: #8b949e;
            --accent: #58a6ff;
            --green: #3fb950;
            --red: #ff7b72;
            --yellow: #d29922;
            --purple: #bc8cff;
            --font-stack: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
            --window-shadow: 0 20px 50px rgba(0,0,0,0.6);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-stack);
            overflow: hidden; /* OS feel */
            height: 100vh;
            width: 100vw;
            user-select: none; /* Desktop feel */
        }

        /* --- BOOT SCREEN --- */
        #boot-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            padding: 40px;
            font-family: 'Courier New', monospace;
            color: var(--text-main);
            display: flex; flex-direction: column; justify-content: flex-start;
        }
        .boot-line { margin-bottom: 5px; opacity: 0; animation: fadeIn 0.1s forwards; }
        .boot-success { color: var(--green); }
        .boot-warn { color: var(--yellow); }
        .cursor-blink { animation: blink 1s step-end infinite; }

        /* --- DESKTOP ENVIRONMENT --- */
        #desktop {
            position: relative; width: 100%; height: 100%;
            opacity: 0; transition: opacity 1s;
        }

        /* Background Canvas */
        #bg-canvas {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
        }

        /* Status Bar (Bottom) */
        #status-bar {
            position: absolute; bottom: 0; left: 0; width: 100%;
            height: 30px; background: var(--term-header);
            border-top: 1px solid #30363d;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; font-size: 0.8rem; z-index: 100;
        }
        .ticker-wrap { width: 60%; overflow: hidden; white-space: nowrap; }
        .ticker { display: inline-block; animation: ticker 20s linear infinite; }
        .ticker-item { margin-right: 20px; }
        .up { color: var(--green); } .down { color: var(--red); }

        /* --- WINDOW MANAGER --- */
        .window {
            position: absolute;
            background: var(--term-bg);
            border: 1px solid #30363d;
            border-radius: 6px;
            box-shadow: var(--window-shadow);
            display: flex; flex-direction: column;
            overflow: hidden;
            min-width: 300px; min-height: 200px;
            transition: transform 0.1s, opacity 0.2s;
        }

        .window.active { border-color: var(--accent); z-index: 50 !important; }

        .window-header {
            background: var(--term-header);
            padding: 8px 15px;
            display: flex; align-items: center; justify-content: space-between;
            cursor: grab;
            border-bottom: 1px solid #30363d;
            user-select: none;
        }
        .window-header:active { cursor: grabbing; }

        .win-controls { display: flex; gap: 8px; }
        .win-btn { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; }
        .close-btn { background: #ff5f56; }
        .min-btn { background: #ffbd2e; }
        .max-btn { background: #27c93f; }

        .win-title { font-size: 0.85rem; color: var(--text-muted); pointer-events: none; }

        .window-content {
            flex: 1; padding: 10px; overflow-y: auto;
            color: var(--text-main); font-size: 0.95rem;
            position: relative;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--term-header); }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #8b949e; }

        /* --- TERMINAL SPECIFIC --- */
        #terminal-window {
            width: 800px; height: 500px;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .output-line { margin-bottom: 5px; line-height: 1.4; word-wrap: break-word; }
        .cmd-line { display: flex; margin-top: 5px; }
        .prompt { color: var(--green); margin-right: 10px; font-weight: bold; }
        .path { color: var(--accent); }
        
        #cmd-input {
            background: transparent; border: none;
            color: var(--text-main); font-family: inherit; font-size: inherit;
            flex: 1; outline: none;
        }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        @keyframes blink { 50% { opacity: 0; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        /* Syntax Highlighting Classes */
        .hl-cmd { color: var(--yellow); }
        .hl-str { color: var(--green); }
        .hl-err { color: var(--red); }
        .hl-info { color: var(--accent); }
        .hl-dir { color: var(--accent); font-weight: bold; }
        .hl-file { color: var(--text-main); }
        .hl-exe { color: var(--green); font-weight: bold; }

    </style>
</head>
<body>

    <div id="boot-screen"></div>

    <div id="desktop">
        <canvas id="bg-canvas"></canvas>

        <div id="terminal-window" class="window active" onmousedown="focusWindow(this)">
            <div class="window-header" id="term-header">
                <div class="win-controls">
                    <div class="win-btn close-btn" onclick="closeWindow('terminal-window')"></div>
                    <div class="win-btn min-btn" onclick="minimizeWindow('terminal-window')"></div>
                    <div class="win-btn max-btn" onclick="maximizeWindow('terminal-window')"></div>
                </div>
                <div class="win-title">taha@tu-berlin: ~</div>
                <div style="width: 40px;"></div> </div>
            <div class="window-content" id="term-content" onclick="document.getElementById('cmd-input').focus()">
                <div id="term-output"></div>
                <div class="cmd-line">
                    <span class="prompt"><span style="color:var(--purple)">root</span>@<span style="color:var(--green)">taha</span>:<span class="path" id="current-path">~</span>$</span>
                    <input type="text" id="cmd-input" autocomplete="off" spellcheck="false">
                </div>
            </div>
        </div>

        <div id="status-bar">
            <div style="font-weight: bold; color: var(--accent);">TahaOS v1.0.4-RLRK</div>
            <div class="ticker-wrap">
                <div class="ticker">
                    <span class="ticker-item">SPX <span class="up">4,950.23 ▲ 0.5%</span></span>
                    <span class="ticker-item">NDX <span class="up">17,543.10 ▲ 1.2%</span></span>
                    <span class="ticker-item">VIX <span class="down">13.40 ▼ 2.1%</span></span>
                    <span class="ticker-item">BTC <span class="up">98,102.00 ▲ 3.4%</span></span>
                    <span class="ticker-item">TAHA <span class="up">1.0 GPA ▲ THESIS</span></span>
                    <span class="ticker-item">JANE <span class="down">REJECTED ▼ (RETRYING)</span></span>
                </div>
            </div>
            <div id="clock">00:00:00</div>
        </div>
    </div>

    <script>
        /* --- 1. BOOT SEQUENCE ENGINE --- */
        const bootMessages = [
            "BIOS Check... OK",
            "Loading Kernel... TahaOS-Quant-v1",
            "Mounting /dev/sda1 (Root)... OK",
            "Checking Memory... 64GB DDR5 OK",
            "Initializing GPU... NVIDIA H100 (Simulated)",
            "Loading Stochastic Modules... OK",
            "Connecting to Neural Network... OK",
            "Starting Shell..."
        ];

        async function runBoot() {
            const screen = document.getElementById('boot-screen');
            for (let i = 0; i < bootMessages.length; i++) {
                const div = document.createElement('div');
                div.className = 'boot-line';
                div.innerHTML = `[ <span class="boot-success">OK</span> ] ${bootMessages[i]}`;
                screen.appendChild(div);
                await new Promise(r => setTimeout(r, Math.random() * 300 + 100));
            }
            await new Promise(r => setTimeout(r, 500));
            screen.style.opacity = '0';
            setTimeout(() => {
                screen.style.display = 'none';
                document.getElementById('desktop').style.opacity = '1';
                initOS();
            }, 1000);
        }

        /* --- 2. FILESYSTEM (VIRTUAL) --- */
        const fileSystem = {
            "~": {
                "projects": {
                    "type": "dir",
                    "content": {
                        "hull_tactical.txt": { type: "file", content: "PROJECT: Hull Tactical Market Prediction\nSTACK: Python, LightGBM, Volatility Targeting\nSTATUS: Active Competition\n\nDeveloping models to forecast daily excess returns under 120% volatility constraint. Using regime detection and feature engineering." },
                        "rlrk_thesis.info": { type: "file", content: "THESIS: Randomized Low-Rank Runge-Kutta Methods\nGRADE: 1.0 (Excellent)\n\nSolved large scale Matrix Differential Equations (Schrödinger) using randomized algebra. Achieved O(n log n) complexity vs O(n^3)." },
                        "ai_olympiad.md": { type: "file", content: "CHALLENGE: AI Math Olympiad (XTX Markets)\n\nBuilding LLM pipelines to solve IMO geometry and number theory problems. Focus on symbolic reasoning and formal verification." }
                    }
                },
                "system": {
                    "type": "dir",
                    "content": {
                        "kernel.log": { type: "file", content: "Kernel started successfully.\nQuant modules loaded.\nWarning: Jane Street interview process detected." },
                        "config.json": { type: "file", content: "{ theme: 'dark', mode: 'beast' }" }
                    }
                },
                "cv.txt": { type: "file", content: "TAHA ATLAGH\nMaster's Student @ TU Berlin\n\nEXPERIENCE:\n- Consultant @ CCT e.V.\n- Founder @ A&T Websolutions\n- Research Assistant @ RWTH Aachen\n\nEDUCATION:\n- M.Sc. Math (TU Berlin)\n- B.Sc. Math (RWTH Aachen) - 1.0 Thesis\n\nSKILLS:\n- Python, C++, MATLAB\n- Stochastic Calculus, Numerics\n" },
                "about.me": { type: "file", content: "Hi, I'm Taha.\nI build mathematical models and software.\nCurrently focusing on:\n1. High Performance Computing\n2. Market Microstructure\n3. Neural SDEs" },
                "contact.sh": { type: "exe", func: () => { window.open('mailto:atlaghtaha@gmail.com'); return "Opening mail client..."; } },
                "linkedin.link": { type: "exe", func: () => { window.open('https://linkedin.com/in/taha-atlagh'); return "Opening LinkedIn..."; } },
                "github.link": { type: "exe", func: () => { window.open('https://github.com/Taha1703'); return "Opening GitHub..."; } }
            }
        };

        let currentPath = ["~"];
        
        /* --- 3. TERMINAL LOGIC --- */
        const input = document.getElementById('cmd-input');
        const output = document.getElementById('term-output');
        const pathSpan = document.getElementById('current-path');
        let history = [];
        let historyIndex = -1;

        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const cmd = this.value.trim();
                if (cmd) {
                    history.push(cmd);
                    historyIndex = history.length;
                    printLine(`<span class="prompt">root@taha:${getPathString()}$</span> ${cmd}`);
                    processCommand(cmd);
                }
                this.value = '';
                // Keep scroll at bottom
                const content = document.getElementById('term-content');
                content.scrollTop = content.scrollHeight;
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    this.value = history[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex < history.length - 1) {
                    historyIndex++;
                    this.value = history[historyIndex];
                } else {
                    historyIndex = history.length;
                    this.value = '';
                }
            } else if (e.key === 'Tab') {
                e.preventDefault();
                autoComplete(this.value);
            }
        });

        function printLine(html) {
            const div = document.createElement('div');
            div.className = 'output-line';
            div.innerHTML = html;
            output.appendChild(div);
        }

        function getPathString() {
            return currentPath.join('/');
        }

        function getCurrentDir() {
            let dir = fileSystem["~"];
            for (let i = 1; i < currentPath.length; i++) {
                dir = dir[currentPath[i]].content;
            }
            return dir;
        }

        function processCommand(raw) {
            const args = raw.split(' ');
            const cmd = args[0].toLowerCase();
            const currentDir = getCurrentDir();

            switch(cmd) {
                case 'help':
                    printLine(`
<span class="hl-info">Available Commands:</span>
  <span class="hl-cmd">ls</span>           List directory content
  <span class="hl-cmd">cd [dir]</span>     Change directory
  <span class="hl-cmd">cat [file]</span>   Show file content
  <span class="hl-cmd">clear</span>        Clear terminal
  <span class="hl-cmd">whoami</span>       Display user info
  <span class="hl-cmd">date</span>         Show current time
  <span class="hl-cmd">matrix</span>       Toggle Matrix visual mode
  <span class="hl-cmd">lorenz</span>       Toggle Lorenz Attractor mode
  <span class="hl-cmd">open [link]</span>  Open executable link
  <span class="hl-cmd">quiz</span>         Start Quant Quiz
                    `);
                    break;
                case 'ls':
                    let out = '';
                    for (let key in currentDir) {
                        const type = currentDir[key].type;
                        if (type === 'dir') out += `<span class="hl-dir">${key}/</span>  `;
                        else if (type === 'exe') out += `<span class="hl-exe">${key}*</span>  `;
                        else out += `<span class="hl-file">${key}</span>  `;
                    }
                    printLine(out);
                    break;
                case 'cd':
                    if (!args[1]) { currentPath = ["~"]; }
                    else if (args[1] === '..') {
                        if (currentPath.length > 1) currentPath.pop();
                    }
                    else if (currentDir[args[1]] && currentDir[args[1]].type === 'dir') {
                        currentPath.push(args[1]);
                    } else {
                        printLine(`<span class="hl-err">Directory not found: ${args[1]}</span>`);
                    }
                    pathSpan.innerText = getPathString();
                    break;
                case 'cat':
                    if (!args[1]) printLine("Usage: cat [filename]");
                    else if (currentDir[args[1]]) {
                        if (currentDir[args[1]].type === 'file') {
                            printLine(currentDir[args[1]].content.replace(/\n/g, '<br>'));
                        } else {
                            printLine(`<span class="hl-err">Not a text file.</span>`);
                        }
                    } else {
                        printLine(`<span class="hl-err">File not found.</span>`);
                    }
                    break;
                case 'open':
                case './':
                    const target = cmd === './' ? args[0] : args[1];
                    // Clean up ./ prefix if user typed ./contact.sh
                    const cleanTarget = target.replace('./', '');
                    if (currentDir[cleanTarget] && currentDir[cleanTarget].type === 'exe') {
                        printLine(currentDir[cleanTarget].func());
                    } else {
                        printLine("Not an executable.");
                    }
                    break;
                case 'clear':
                    output.innerHTML = '';
                    break;
                case 'whoami':
                    printLine("root user (Taha Atlagh) - Quant Developer & Math MSc");
                    break;
                case 'date':
                    printLine(new Date().toString());
                    break;
                case 'matrix':
                    printLine("Switching visual mode to: MATRIX");
                    startMatrix();
                    break;
                case 'lorenz':
                    printLine("Switching visual mode to: LORENZ");
                    startLorenz();
                    break;
                case 'sudo':
                    printLine("taha is not in the sudoers file. This incident will be reported.");
                    break;
                case 'quiz':
                    printLine("Launching Quant Quiz Module...");
                    printLine("Q: Expectation of a d6 roll given you can reroll once if outcome < 4?");
                    printLine("(Type 'answer X' to solve)");
                    break;
                case 'answer':
                    if (args[1] === '4.25') printLine("<span class='hl-str'>Correct! (Expectation is 4.25)</span>");
                    else printLine("<span class='hl-err'>Incorrect. Expected value logic: E = 0.5*3.5 + 0.5*(4+5+6)/3 = 1.75 + 2.5 = 4.25</span>");
                    break;
                default:
                    // Handle executing ./script directly
                    if (cmd.startsWith('./')) {
                        const exe = cmd.substring(2);
                        if (currentDir[exe] && currentDir[exe].type === 'exe') {
                            printLine(currentDir[exe].func());
                        } else {
                            printLine(`Command not found: ${cmd}`);
                        }
                    } else {
                        printLine(`Command not found: ${cmd}. Type 'help' for commands.`);
                    }
            }
        }

        function autoComplete(partial) {
            const currentDir = getCurrentDir();
            const hits = Object.keys(currentDir).filter(k => k.startsWith(partial));
            if (hits.length === 1) {
                input.value = hits[0];
            } else if (hits.length > 1) {
                printLine(hits.join('  '));
            }
        }

        /* --- 4. WINDOW MANAGER LOGIC --- */
        let isDragging = false;
        let dragOffsetX, dragOffsetY;
        const termWin = document.getElementById('terminal-window');
        const termHeader = document.getElementById('term-header');

        termHeader.addEventListener('mousedown', (e) => {
            if (e.target.classList.contains('win-btn')) return;
            isDragging = true;
            dragOffsetX = e.clientX - termWin.offsetLeft;
            dragOffsetY = e.clientY - termWin.offsetTop;
            focusWindow(termWin);
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                termWin.style.left = `${e.clientX - dragOffsetX}px`;
                termWin.style.top = `${e.clientY - dragOffsetY}px`;
                termWin.style.transform = 'none'; // Disable center translate
            }
        });

        document.addEventListener('mouseup', () => isDragging = false);

        function focusWindow(win) {
            document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));
            win.classList.add('active');
        }

        function minimizeWindow(id) {
            const win = document.getElementById(id);
            win.style.display = 'none';
        }
        function closeWindow(id) {
            minimizeWindow(id);
            // In a real OS, this would kill the process. Here we just hide.
            printLine("Session terminated. Refresh to restart.");
        }
        function maximizeWindow(id) {
            const win = document.getElementById(id);
            if (win.style.width === '100%') {
                win.style.width = '800px';
                win.style.height = '500px';
                win.style.top = '50%';
                win.style.left = '50%';
                win.style.transform = 'translate(-50%, -50%)';
            } else {
                win.style.width = '100%';
                win.style.height = 'calc(100% - 30px)'; // Minus statusbar
                win.style.top = '0';
                win.style.left = '0';
                win.style.transform = 'none';
            }
        }

        /* --- 5. VISUALIZATIONS (CANVAS) --- */
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let animationId;
        let visualMode = 'lorenz'; // 'lorenz' or 'matrix'

        function resize() { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; }
        window.addEventListener('resize', resize);
        
        // --- MATRIX RAIN ---
        const katakana = 'アァカサタナハマヤャラワガザダバパイィキシチニヒミリヰギジヂビピウゥクスツヌフムユュルグズブヅプエェケセテネヘメレヱゲゼデベペオォコソトノホモヨョロヲゴゾドボポヴッン';
        const latin = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        const nums = '01';
        const alphabet = katakana + latin + nums;
        const fontSize = 16;
        let columns;
        let drops;

        function initMatrix() {
            columns = Math.floor(width / fontSize);
            drops = [];
            for(let x = 0; x < columns; x++) drops[x] = 1;
        }

        function drawMatrix() {
            ctx.fillStyle = 'rgba(13, 17, 23, 0.05)';
            ctx.fillRect(0, 0, width, height);
            ctx.fillStyle = '#0F0';
            ctx.font = fontSize + 'px monospace';

            for(let i = 0; i < drops.length; i++) {
                const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
                ctx.fillText(text, i*fontSize, drops[i]*fontSize);
                if(drops[i]*fontSize > height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }

        // --- LORENZ ATTRACTOR ---
        let lx = 0.1, ly = 0, lz = 0;
        const sigma = 10, rho = 28, beta = 8/3, dt = 0.01;
        const points = [];
        let camAngle = 0;

        function drawLorenz() {
            ctx.fillStyle = 'rgba(13, 17, 23, 0.1)';
            ctx.fillRect(0, 0, width, height);

            let dx = (sigma * (ly - lx)) * dt;
            let dy = (lx * (rho - lz) - ly) * dt;
            let dz = (lx * ly - beta * lz) * dt;
            lx += dx; ly += dy; lz += dz;

            points.push({x: lx, y: ly, z: lz});
            if (points.length > 2500) points.shift();

            ctx.beginPath();
            ctx.strokeStyle = '#58a6ff';
            ctx.lineWidth = 1;

            const scale = 18;
            const cx = width / 2;
            const cy = height / 2;

            camAngle += 0.005; // Auto rotate

            for (let i = 0; i < points.length - 1; i++) {
                let p = points[i];
                let pn = points[i+1];
                
                // Rotation Matrix (Y-axis)
                let rx = p.x * Math.cos(camAngle) - p.z * Math.sin(camAngle);
                let rz = p.x * Math.sin(camAngle) + p.z * Math.cos(camAngle);
                
                let rxn = pn.x * Math.cos(camAngle) - pn.z * Math.sin(camAngle);
                let rzn = pn.x * Math.sin(camAngle) + pn.z * Math.cos(camAngle);

                // Simple 3D projection
                let fov = 400;
                let scale1 = fov / (fov + rz + 50); // Perspective
                let scale2 = fov / (fov + rzn + 50);

                let x2d = rx * scale * scale1 + cx;
                let y2d = -p.y * scale * scale1 + cy;
                
                let x2dn = rxn * scale * scale2 + cx;
                let y2dn = -pn.y * scale * scale2 + cy;

                ctx.moveTo(x2d, y2d);
                ctx.lineTo(x2dn, y2dn);
                
                // Color gradient based on Z
                ctx.globalAlpha = (i / points.length);
            }
            ctx.stroke();
            ctx.globalAlpha = 1.0;
        }

        function animate() {
            if (visualMode === 'lorenz') drawLorenz();
            else if (visualMode === 'matrix') drawMatrix();
            animationId = requestAnimationFrame(animate);
        }

        function startLorenz() {
            visualMode = 'lorenz';
            points.length = 0;
            ctx.clearRect(0, 0, width, height);
        }

        function startMatrix() {
            visualMode = 'matrix';
            initMatrix();
            ctx.clearRect(0, 0, width, height);
        }

        /* --- 6. INIT SYSTEM --- */
        function initOS() {
            resize();
            startLorenz();
            animate();
            
            // Welcome Message
            setTimeout(() => {
                printLine("Welcome to TahaOS (v1.0.4).");
                printLine("Type 'help' for available commands.");
                printLine("<br>");
                printLine("Last login: " + new Date().toString());
                printLine("<br>");
            }, 500);

            // Clock
            setInterval(() => {
                const d = new Date();
                document.getElementById('clock').innerText = d.toLocaleTimeString();
            }, 1000);
        }

        // STARTUP
        window.onload = function() {
            runBoot();
        };

    </script>
</body>
</html>
